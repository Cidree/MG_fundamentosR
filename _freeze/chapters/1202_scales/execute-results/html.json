{
  "hash": "d7afe8dd6b4266c70dbc30b4dbe865a7",
  "result": {
    "engine": "knitr",
    "markdown": "---\nexecute: \n  warning: false\neditor_options: \n  chunk_output_type: console\nfilters: \n    - webr\nwebr:\n    packages: [\"dplyr\", \"ggplot2\"]\n---\n\n\n\n\n# Scales {#sec-scales}\n\nLas escalas son una parte fundamental de la visualización de datos. Son las encargadas de mapear los valores de los datos a los elementos visuales de la gráfica. Podemos dividirlas en las siguientes clases:\n\n-   **Escalas continuas**: se utilizan para modificar la apariencia de los elementos visuales en función de valores numéricos.\n\n-   **Escalas discretas**: se utilizan para modificar la apariencia de los elementos visuales en función de valores categóricos.\n\n-   **Escalas en intervalos**: se utilizan para modificar la apariencia de los elementos visuales en función de valores numéricos que se encuentran en un intervalo.\n\nAdemás, se puede subdividir las escalas en función de la estética que modifican:\n\n-   **Escalas de posición y ejes**: controlar la posición de los elementos visuales además de sus ejes. En esta categoría tenemos la estética `x` e `y`.\n\n-   **Escalas de colores**: controlan el color externo y color de relleno de los elementos visuales y sus leyendas. En esta categoría tenemos las estéticas `color` y `fill`.\n\n-   **Otras escalas**: controlar el aspecto de los elementos visuales y sus respectivas leyendas. En esta categoría tenemos las estéticas `alpha`, `linetype`, `linewidth`, `shape` y `size`.\n\nEn este capítulo vamos a trabajar con tres *datasets*:\n\n-   `iris`: *dataset* donde se han medido la longitud y anchura de pétalos y sépalos de 150 flores, además de la especie a la que pertenecen (ver [Tipos de visualización](#sec-visualization-types){target=\"_blank\"}).\n\n-   `gapminder`: *dataset* con la evolución temporal del desarrollo económico, población y esperanza de vida de los países del mundo (ver [Tipos de visualización](#sec-visualization-types){target=\"_blank\"}). Filtraremos solamente los datos del 2002.\n\n-   `inventario`: *dataset* con datos de inventario de 27 parcelas en los que se ha medido el DBH, altura y especie (ver @sec-vis-data).\n\nPara comenzar, vamos a cargar los paquetes necesarios y a leer los datos que utilizaremos en este capítulo.\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## Cargar paquetes\nlibrary(gapminder)\nlibrary(geomtextpath)\nlibrary(tidyverse)\n## Cargar datos\ninventario_tbl <- read_rds(\"../data/inventario_prep.rds\")\n```\n:::\n\n\n\n\n## Estructura de las escalas\n\nLas escalas en `ggplot2` son funciones que tienen una estructura de generalmente tres palabras separadas por un guión bajo. Estas palabras son:\n\n-   **scale**: es la primera palabra de la función siempre.\n\n-   **Nombre de la estética**: es la segunda palabra de la función y se refiere a la estética que se quiere modificar (`x`, `y`, `color`, `fill`, `alpha`, `linetype`, `linewidth`, `shape` o `size`).\n\n-   **Tipo de escala**: es la tercera palabra de la función y se refiere al tipo de escala que se quiere aplicar (`continuous`, `discrete`, `manual`, `identity`, `log`, ...).\n\nEn las siguientes sección veremos algunas de las más importantes.\n\n## Escalas de posición\n\nLas escalas de posición se utilizan para mapear los valores de los datos a las posiciones de los elementos visuales de la gráfica. Todos los gráficos tienen dos escalas de posición que son la estética `x` y la estética `y`. Todos los gráficos traen una escala por defecto que depende de si la variable es categórica o numérica:\n\n-   `scale_x_continuous()` y : escala de posición para variables numéricas en el eje x.\n\n-   `scale_y_continuous()`: escala de posición para variables numéricas en el eje y.\n\n-   `scale_x_discrete()`: escala de posición para variables categóricas en el eje x.\n\n-   `scale_y_discrete()`: escala de posición para variables categóricas en el eje y.\n\n::: callout-note\nExiste alguna excepción como el formato fecha que utiliza `scale_*_date()` o el formato fecha-tiempo que utiliza `scale_*_datetime()`.\n:::\n\nVamos a empezar con un ejemplo sencillo utilizando el *dataset* `iris`.\n\n::: panel-tabset\n## Sin escalas\n\nEn este primer ejemplo, generamos un gráfico de la distribución de la anchura del sépalo según la especie. Tenemos que añadir una semilla para que el proceso aleatorio de `geom_jitter()` sea el mismo en ambos ejemplos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nggplot(iris, aes(x = Species, y = Sepal.Width)) +\n    geom_jitter(height = 0, width = .2)\n```\n\n::: {.cell-output-display}\n![Distribución de la anchura del pétalo por especie de Iris](1202_scales_files/figure-html/fig-jitter-no-scales-1.png){#fig-jitter-no-scales width=672}\n:::\n:::\n\n\n\n\n## Con escalas\n\nSi añadimos las escalas que supuestamente son las que vienen por defecto, no debería cambiar nada en nuestro gráfico:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nggplot(iris, aes(x = Species, y = Sepal.Width)) +\n    geom_jitter(height = 0, width = .2) +\n    scale_x_discrete() +\n    scale_y_continuous()\n```\n\n::: {.cell-output-display}\n![Distribución de la anchura del pétalo por especie de Iris](1202_scales_files/figure-html/fig-jitter-scales-1.png){#fig-jitter-scales width=672}\n:::\n:::\n\n\n\n:::\n\nPues bien, hasta aquí nada nuevo. Vamos a empezar a ver finalmente qué podemos hacer con las escalas de posición.\n\n### Escalas de posición continuas\n\nPara trabajar sobre escalas de posición continuas vamos a partir de este ejemplo que ya hemos trabajado en secciones anteriores del dataset de `gapminder`. Vamos a empezar preparando los datos:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder_tbl <- gapminder |> \n    filter(continent != \"Africa\") |>\n    mutate(year = as_date(\n        paste0(year, \"-01-01\")\n    ))\n```\n:::\n\n\n\n\nComo veis, estamos convirtiendo la columna `year` a tipo de dato `Date` en lugar de `numeric`. En un rato veréis por qué.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot <- gapminder_tbl |> \n    ggplot(\n        aes(x = year, y = gdpPercap, color = country, group = country)\n    ) +\n    geom_line(color = \"grey80\") +\n    geom_textpath(\n        aes(x = year, y = gdpPercap, label = country),\n        data  = gapminder_tbl |> filter(country %in% c(\"Kuwait\", \"Nicaragua\", \"Haiti\")),\n        color = \"#BC3908\",\n        lwd   = 1,\n        size  = 3\n    ) +\n    labs(\n        x     = NULL,\n        y     = \"PIB per cápita\",\n        color = NULL,\n        title = \"La mayoría de países aumentaron su PIB per cápita entre 1952 y 2007. \\nKuwait, Nicaragua y Haiti no\"\n    ) +\n    theme_minimal()\n\nbase_plot\n```\n\n::: {.cell-output-display}\n![Spaguetti plot mostrando la evolución del PIB per cápita de los países del mundo](1202_scales_files/figure-html/fig-spaguetti-scales-1.png){#fig-spaguetti-scales width=672}\n:::\n:::\n\n\n\n\nVamos a ver qué podemos modificar:\n\n::: panel-tabset\n## Intervalos\n\nPodemos indicar un vector de valores para especificar los valores que queremos ver en los ejes. Además, con name también podemos modificar el nombre de este eje (al igual que en la función `labs()`).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_y_continuous(\n        name   = \"PIB per cápita ($)\",\n        breaks = seq(0, 100000, 20000)\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\nFíjate que al superar los 5 dígitos la notación es decimal. Podemos cambiar este comportamiento del siguiente modo:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(scipen = 999)\nbase_plot +\n    scale_y_continuous(\n        name   = \"PIB per cápita ($)\",\n        breaks = seq(0, 100000, 20000)\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n## Número de intervalos\n\nEn lugar de indicar los intervalos que queremos, podemos indicar un número de intervalos para que la función los calcule óptimamente. Vamos a indicar un total de 10 intervalos:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_y_continuous(\n        name     = \"PIB per cápita ($)\",\n        n.breaks = 10\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n## Intervalos menores\n\nSi te fijas, en la grilla del gráfico tenemos unas líneas más gruesas en las etiquetas y otras más finas entre las etiquetas. Estás líneas más finas son los intervalos menores. Para ver lo que significa esto, vamos a crear un `minor break` cada \\$2000.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_y_continuous(\n        name         = \"PIB per cápita ($)\",\n        n.breaks     = 10,\n        minor_breaks = seq(0, 110000, 2000)\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\n## Etiquetas ejes\n\nLas etiquetas son los valores que muestran los intervalos que creamos con `breaks` o `n_breaks`. Podemos poner lo que queramos. Por ver un ejemplo obvio de lo que se puede hacer:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_y_continuous(\n        name   = \"PIB per cápita ($)\",\n        breaks = seq(0, 100000, 20000),\n        labels = c(\"Cero\", \"Primera\", \"Segunda\", \"Tercera\", \"Cuarta\", \"Quinta\")\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\nAhora vamos a ver un ejemplo mucho más útil utilizando el paquete `scales`. Este paquete nos permite añadir símbolos, separar unidades, etc. En lugar de tener valores como 100000, vamos a modificarlos para que muestren \\$100,000. Para ello utilizamos la función `label_dollar()` que por defecto modifica el comportamiento al que nosotros queremos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_y_continuous(\n        breaks = seq(0, 100000, 20000),\n        labels = scales::label_dollar()\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\nComo en España es común separar decimales por comas y los miles por puntos, podemos modificar este comportamiento así:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_y_continuous(\n        breaks = seq(0, 100000, 20000),\n        labels = scales::label_dollar(\n            big.mark     = \".\",\n            decimal.mark = \",\"\n        )\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n\nPuede parecer una sintaxis extraña. Este tipo de funciones se llaman *function factories* y es un tema avanzado y que queda fuera de los objetivos de este curso. En [este enlace](https://adv-r.hadley.nz/function-factories.html) se puede ver una lectura adicional sobre este tipo de funciones.\n\n## Límites ejes\n\nFinalmente, vamos a ver que podemos hacer zoom a un área del gráfico. Vamos a ver el área de \\$0 hasta \\$20,000.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_y_continuous(\n        name   = \"PIB per cápita ($)\",\n        limits = c(0, 20000)\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n:::\n\nEste sería el funcionamiento básico de las funciones `scale_*_continuous()`. No obstante, podemos modificar la función utilizando una aceptable por variables continuas:\n\n::: panel-tabset\n## Transformaciones\n\nLas escalas normales van a mapear los valores originales de nuestros datos. Sin embargo, podemos aplicar transformaciones directas a las escalas como por ejemplo la transformación logarítmica:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_y_log10()\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n\nDel mismo modo, podemos aplicar los mismos argumentos:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_y_log10(\n        name   = \"PIB (escala logarítmica)\",\n        breaks = seq(0, 100000, 20000),\n        labels = scales::label_dollar(\n            big.mark     = \".\",\n            decimal.mark = \",\"\n        )\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n\nComo utilizamos logaritmos nos aparecen los decimales que son siempre dos ceros. Podemos eliminarlos:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_y_log10(\n        name   = \"PIB (escala logarítmica)\",\n        breaks = seq(0, 100000, 20000),\n        labels = scales::label_dollar(\n            big.mark     = \".\",\n            decimal.mark = \",\",\n            accuracy     = 1\n        )\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n\n## Fechas\n\nPara variables de tipo fecha tenemos una serie de funciones que nos ayudan a mostrar las etiquetas. Sin embargo, tenemos que convertir el tipo de dato a fecha, algo que hemos hecho previamente cuando creamos `gapminder_tbl`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_x_date()\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n\nEn verdad, cuando la variable es de tipo fecha se aplica esta escala por defecto. Vamos a modificar sus etiquetas para ver los años de cinco en cinco. Podemos utilizar el argumento `date_breaks` que permite una sintaxis muy flexible y amigable:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_x_date(\n        date_breaks = \"5 years\"\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n\nVaya infortunio. Esta función nos añade los meses y los años... Pero no os preocupéis!! Paquete `scales` al rescate:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_x_date(\n        date_breaks = \"5 years\",\n        labels      = scales::label_date(format = \"%Y\")\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n\nEl argumento `format` nos permite escribir el formato de fecha siguiendo unos estándares. Busca la ayuda de la función `strptime()` para ver las opciones disponibles. Las más comunes puedes verlas [aquí](https://ggplot2-book.org/scales-position#sec-date-labels). Existe una opción que no necesita del paquete `scales`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot +\n    scale_x_date(\n        date_breaks = \"5 years\",\n        date_labels = \"%Y\"\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n:::\n\nPues esto sería todo por esta parte de la sección. Como ves, es muy sencillo trabajar con las escalas gracias a la gramática de gráficos adaptada a `{ggplot2}`.\n\n### Escalas de posición discretas\n\nVamos a ver ahora las escalas que mapean una variable de tipo categórico. La verdad es que aquí no vamos a introducir nada nuevo. La única diferencia con las anteriores es que utilizamos una función distinta y los argumentos que tenemos disponibles. En este caso no tiene sentido crear intervalos en la escala, ya que una variable categórica tiene los valores fijos. Lo que podemos es modificar las etiquetas y también la posición de la escala (esto lo podemos hacer también con las funciones anteriores, pero quería añadir algo nuevo en esta sección).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nggplot(iris, aes(x = Species, y = Sepal.Width)) +\n    geom_jitter(height = 0, width = .2) +\n    scale_x_discrete(\n        name     = NULL,\n        labels   = c(\"I. setosa\", \"I. versicolor\", \"I. virginica\"),\n        position = \"top\"\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n\n\nFinalmente, puedes ver que todas las funciones tienen un argumento denominado `guide`. Esto lo veremos más adelante.\n\n## Escalas de colores\n\nLas escalas de colores modifican el color de las líneas (`color`) y el color de relleno (`fill`). Las escalas de posición actúan sobre los ejes `x` e `y`, mientras que las que veremos en esta sección actúan sobre los colores de las geometrías generando una leyenda. Por defecto, se aplican las siguientes:\n\n-   `scale_color_continuous()` / `scale_fill_continuous()`: para variables continuas.\n\n-   `scale_color_discrete()` / `scale_fill_discrete()`: para variables categóricas.\n\n### Variables continuas\n\nVamos a empezar viendo como actúan las escalas por defecto en variables continuas:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base <- gapminder |> \n    filter(year == 2007) |> \n    ggplot(\n        aes(x = gdpPercap, y = lifeExp, color = pop)\n    ) +\n    geom_point() +\n    labs(\n        x = \"PIB per cápita\",\n        y = \"Esperanza de vida\"\n    ) +\n    theme_minimal()\n\nscatter_base\n```\n\n::: {.cell-output-display}\n![Scatter plot del PIB per cápita, esperanza de vida y población de los países del mundo](1202_scales_files/figure-html/fig-gapminder-scales-scatter-1.png){#fig-gapminder-scales-scatter width=672}\n:::\n:::\n\n\n\n\nLa función `scale_color_continuous()` nos permite modificar la escala de colores con unos argumentos similares a los que vimos en las escalas de posición. Vamos a ver un ejemplo:\n\n::: panel-tabset\n## Intervalos\n\nLos intervalos los definimos de nuevo con `breaks` o `n.breaks`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    scale_color_continuous(\n        name   = \"Población\",\n        breaks = seq(0, 1e9, 2e8)\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    scale_color_continuous(\n        name     = \"Población\",\n        n.breaks = 3\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n\n\n## Etiquetas ejes\n\nLas etiquetas las definimos con `labels`. Vamos a ver un ejemplo con el paquete `scales`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    scale_color_continuous(\n        name   = \"Población\",\n        labels = scales::label_number(\n            big.mark     = \".\",\n            decimal.mark = \",\"\n        )\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n\n\n## Tipo de paleta\n\nPodemos modificar el tipo de paleta de colores con el argumento `type`. Este es un argumento que las escalas de posición no tienen.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    scale_color_continuous(\n        name = \"Población\",\n        type = \"viridis\"\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n\n:::\n\nEn la última pestaña hemos visto como utilizar una paleta de colores mediante el argumento `type`. Sin embargo, algunas paletas comunes traen sus propias funciones del tipo `scale_color_*()` con una mayor flexibilidad.\n\n#### Paletas predefinidas\n\nLas escalas `viridis` [@garnier2018viridis] son una familia de paletas de colores que seguramente has visto en muchos gráficos. Estas son unas paletas con un gran diseño y que además son amigables con problemas de visión como el daltonismo. En la siguiente aplicación puedes ver las escalas `viridis` modificando el argumento `option` de la función `scale_color_viridis_c()`.\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n\n## Load packages\nlibrary(bslib)\nlibrary(dplyr)\nlibrary(gapminder)\nlibrary(ggplot2)\nlibrary(glue)\nlibrary(shiny)\nlibrary(shinyWidgets)\n\n## UI\nui <- page_sidebar(\n    sidebar = sidebar(\n        open = \"open\",\n        width = 200,\n        selectInput(\n            inputId = \"option\", \n            label   = \"Paleta\", \n            choices = c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\"),\n            selected = \"D\"\n        ),\n        prettySwitch(\n            inputId  = \"direction\",\n            label    = \"Invertir paleta\",\n            status   = \"success\",\n            fill     = TRUE\n        ),\n        prettySwitch(\n            inputId = \"binned\",\n            label   = \"Binned\",\n            status  = \"success\",\n            fill    = TRUE\n        )\n    ),\n    verbatimTextOutput(\"code\") |> card(),\n    plotOutput(\"plot\", width = 500) |> card()\n)\n\n## Server\nserver <- function(input, output, session) {\n    \n    output$code <- renderPrint({\n        glue(\n            \n            if (input$binned) {\n                'scatter_base +\n                    scale_color_viridis_b(\n                        option    = \"{input$option}\",\n                        direction = {if (input$direction) -1 else 1}\n                    )'\n            } else {\n                'scatter_base +\n                    scale_color_viridis_c(\n                        option    = \"{input$option}\",\n                        direction = {if (input$direction) -1 else 1}\n                    )'\n            }\n            \n            )\n    })\n\n    ## Plot\n    output$plot <- renderPlot({\n        \n        if (input$binned) {\n            gapminder |> \n            filter(year == 2007) |> \n            ggplot(\n                aes(x = gdpPercap, y = lifeExp, color = pop)\n            ) +\n            geom_point() +\n            labs(\n                x = \"PIB per cápita\",\n                y = \"Esperanza de vida\"\n            ) +\n            theme_minimal(base_size = 8) +\n            scale_color_viridis_b(\n                option    = input$option,\n                direction = if (input$direction) -1 else 1\n            )\n        } else {\n            gapminder |> \n            filter(year == 2007) |> \n            ggplot(\n                aes(x = gdpPercap, y = lifeExp, color = pop)\n            ) +\n            geom_point() +\n            labs(\n                x = \"PIB per cápita\",\n                y = \"Esperanza de vida\"\n            ) +\n            theme_minimal(base_size = 8) +\n            scale_color_viridis_c(\n                option    = input$option,\n                direction = if (input$direction) -1 else 1\n            )\n        }\n        \n        }, res = 96\n    )\n}\n\n## Run app\nshinyApp(ui = ui, server = server)\n```\n\nEstas funciones pueden terminar en:\n\n-   `scale_color_viridis_c()`: para variables continuas.\n\n-   `scale_color_viridis_d()`: para variables discretas.\n\n-   `scale_color_viridis_b()`: para variables continuas que se quieren dividir en intervalos.\n\nPor otro lado, tenemos la familia de paletas de colores `ColorBrewer` [@RColorBrewer], que podemos ver en la siguiente figura:\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Paletas de colores Brewer](1202_scales_files/figure-html/fig-brewer-pals-1.png){#fig-brewer-pals width=672}\n:::\n:::\n\n\n\n\nPara acceder a ellas, podemos utilizar las funciones:\n\n-   `scale_color_distiller()`: para variables continuas\n\n-   `scale_color_brewer()`: para variables discretas\n\n-   `scale_color_fermenter()`: para variables continuas que se quieren dividir en intervalos\n\nA medida que utilices `ggplot2` irás descubriendo paquetes que traen sus propias escalas de colores. Algunos ejemplos son `{ggsci}` [@ggsci], `{MetBrewer}` [@MetBrewer], o `{scico}` [@scico].\n\nEn la siguiente aplicación puedes probar distintas paletas `ColorBrewer`:\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n\n## Load packages\nlibrary(bslib)\nlibrary(dplyr)\nlibrary(gapminder)\nlibrary(ggplot2)\nlibrary(glue)\nlibrary(RColorBrewer)\nlibrary(shiny)\nlibrary(shinyWidgets)\n\n## UI\nui <- page_sidebar(\n    sidebar = sidebar(\n        open = \"open\",\n        width = 200,\n        selectInput(\n            inputId  = \"option\", \n            label    = \"Paleta\", \n            choices  = rownames(brewer.pal.info),\n            selected = \"Reds\"\n        ),\n        prettySwitch(\n            inputId  = \"direction\",\n            label    = \"Invertir paleta\",\n            status   = \"success\",\n            fill     = TRUE\n        ),\n        prettySwitch(\n            inputId = \"binned\",\n            label   = \"Binned\",\n            status  = \"success\",\n            fill    = TRUE\n        )\n    ),\n    verbatimTextOutput(\"code\") |> card(),\n    plotOutput(\"plot\", width = 500) |> card()\n)\n\n## Server\nserver <- function(input, output, session) {\n    \n    output$code <- renderPrint({\n        glue(\n            \n            if (input$binned) {\n                'scatter_base +\n                    scale_color_fermenter(\n                        palette   = \"{input$option}\",\n                        direction = {if (input$direction) -1 else 1}\n                    )'\n            } else {\n                'scatter_base +\n                    scale_color_distiller(\n                        palette   = \"{input$option}\",\n                        direction = {if (input$direction) -1 else 1}\n                    )'\n            }\n            \n            )\n    })\n\n    ## Plot\n    output$plot <- renderPlot({\n        \n        if (input$binned) {\n            gapminder |> \n            filter(year == 2007) |> \n            ggplot(\n                aes(x = gdpPercap, y = lifeExp, color = pop)\n            ) +\n            geom_point() +\n            labs(\n                x = \"PIB per cápita\",\n                y = \"Esperanza de vida\"\n            ) +\n            theme_minimal(base_size = 8) +\n            scale_color_fermenter(\n                palette   = input$option,\n                direction = if (input$direction) -1 else 1\n            )\n        } else {\n            gapminder |> \n            filter(year == 2007) |> \n            ggplot(\n                aes(x = gdpPercap, y = lifeExp, color = pop)\n            ) +\n            geom_point() +\n            labs(\n                x = \"PIB per cápita\",\n                y = \"Esperanza de vida\"\n            ) +\n            theme_minimal(base_size = 8) +\n            scale_color_distiller(\n                palette   = input$option,\n                direction = if (input$direction) -1 else 1\n            )\n        }\n        \n        }, res = 96\n    )\n}\n\n## Run app\nshinyApp(ui = ui, server = server)\n```\n\n#### Paletas manuales\n\nEn algunos paquetes tenemos una infinidad de paletas de colores predefinidas, pero puede haber ocasiones en las que prefiramos definir nosotros mismos la paleta de colores. Para ello, tenemos tres funciones que nos permiten definir una paleta de colores continua de forma manual:\n\n-   `scale_color_gradient()`: a partir de dos colores, generamos un gradiente (definimos color mínimo y color máximo).\n\n-   `scale_color_gradient2()`: a partir de tres colores (siendo el tercero el punto medio)\n\n-   `scale_color_gradientn()`: a partir de *n* colores\n\nVamos a ver estos tres en acción:\n\n::: panel-tabset\n## Gradient\n\nEn este caso, debemos especificar dos colores, y el resto se interpola entre ellos:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    scale_color_gradient(\n        name = \"Población\",\n        low  = \"blue\",\n        high = \"green\"\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n\n\n## Gradient2\n\nEn este caso, especificaremos además el color del medio. Por defecto, este punto es el valor de 0, por lo que podemos modificarlo a nuestro parecer con `midpoint`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    scale_color_gradient2(\n        name = \"Población\",\n        low  = \"blue\",\n        mid  = \"red\",\n        high = \"green\",\n        midpoint = 7e8\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\n\n\n## Gradientn\n\nFinalmente, esta es una de las opciones más flexibles ya que en muchas ocasiones utilizaremos paletas de colores de varios colores que vienen dentro de algún paquete, y que en lugar de traer funciones del tipo `scale_color_*`, traen vectores de códigos hexadecimales con los colores. Un ejemplo son las paletas que vienen dentro de la función `hcl.colors()`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    scale_color_gradientn(\n        name   = \"Población\",\n        colors = hcl.colors(50, palette = \"Spectral\")\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n\n\nLas paletas pueden explorarse [aquí](https://colorspace.r-forge.r-project.org/articles/hcl_palettes.html).\n:::\n\n### Leyendas\n\nLa apariencia de las leyendas se controla mediante las guías (*guides*). En el caso de variables continuas tenemos `guide_colorbar()`. Para modificar esto, debemos añadir la función `guides()`, y dentro elegir una estética que igualaremos a `guide_colorbar()`, como en este ejemplo:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    guides(\n        color = guide_colorbar()\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n\n\nDentro de esta función tenemos un montón de argumentos que podemos modificar para cambiar la apariencia de la leyenda, como pueden ser:\n\n-   `title`: de nuevo, el título de la leyenda.\n\n-   `title.position`: posición del título con respecto a la barra\n\n-   `title.hjust`: justificación del título\n\n-   `direction`: dirección de la barra\n\n-   `position`: posición de la leyenda con respecto al gráfico\n\n-   `barwidth` y `barheight`: anchura y altura de la barra\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    guides(\n        color = guide_colorbar(\n            title          = \"Población\",\n            title.position = \"top\",\n            title.hjust    = .5,\n            direction      = \"horizontal\",\n            position       = \"top\",\n            barwidth       = unit(10, \"cm\"),\n            barheight      = unit(2, \"mm\")\n        )\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n\n\n### Variables discretas\n\nLas escala que se aplica por defecto a las variables discretas es `scale_color_discrete()`. Vamos a partir del siguiente gráfico, donde la estética color utiliza la variable del continente:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base <- gapminder |> \n    filter(year == 2007) |> \n    ggplot(\n        aes(x = gdpPercap, y = lifeExp, color = continent)\n    ) +\n    geom_point() +\n    labs(\n        x = \"PIB per cápita\",\n        y = \"Esperanza de vida\"\n    ) +\n    theme_minimal()\n\nscatter_base\n```\n\n::: {.cell-output-display}\n![Scatter plot del PIB per cápita, esperanza de vida y continente](1202_scales_files/figure-html/fig-gapminder-scales-scatter-discrete-1.png){#fig-gapminder-scales-scatter-discrete width=672}\n:::\n:::\n\n\n\n\n#### Paletas manuales\n\nVamos a ver a continuación las opciones más comunes para modificar en la función base:\n\n-   `name`: título de la leyenda\n\n-   `labels`: etiquetas que se muestran en la leyenda\n\n-   `type`: vector de colores\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    scale_color_discrete(\n        name   = \"Continente\",\n        labels = c(\"África\", \"América\", \"Asia\", \"Europa\", \"Oceanía\"),\n        type   = hcl.colors(n = 5, palette = \"Dark 2\")\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\n\n\nEque `scale_color_discrete()`, pero con un nombre más intuitivo: `scale_color_manual()`. Como diferencia, utiliza el argumento `values` para definir los colores. Vamos a ver cómo se utiliza:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    scale_color_manual(\n        name   = \"Continente\",\n        labels = c(\"África\", \"América\", \"Asia\", \"Europa\", \"Oceanía\"),\n        values = hcl.colors(n = 5, palette = \"Dark 2\")\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\n\n\n#### Paletas predefinidas\n\nPara el caso de las variables categóricas, también tenemos la opción de utilizar `scale_color_brewer()` para una paleta de colores ColorBrewer [@fig-brewer-pals]. Para variables categóricas, es más interesante utilizar el segundo grupo de paletas de la @fig-brewer-pals, debido a que nos interesa tener colores distintos para cada clase, y no una paleta secuencial donde los colores son similares.\n\nSi queremos utilizar una paleta de `viridis`, podemos utilizar la función `scale_color_viridis_d()`.\n\n::: panel-tabset\n## Color Brewer\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n\n## Load packages\nlibrary(bslib)\nlibrary(dplyr)\nlibrary(gapminder)\nlibrary(ggplot2)\nlibrary(glue)\nlibrary(RColorBrewer)\nlibrary(shiny)\nlibrary(shinyWidgets)\n\n## UI\nui <- page_sidebar(\n    sidebar = sidebar(\n        open = \"open\",\n        width = 200,\n        selectInput(\n            inputId  = \"option\", \n            label    = \"Paleta\", \n            choices  = rownames(brewer.pal.info),\n            selected = \"Reds\"\n        ),\n        prettySwitch(\n            inputId  = \"direction\",\n            label    = \"Invertir paleta\",\n            status   = \"success\",\n            fill     = TRUE\n        )\n    ),\n    verbatimTextOutput(\"code\") |> card(),\n    plotOutput(\"plot\", width = 500) |> card()\n)\n\n## Server\nserver <- function(input, output, session) {\n    \n    output$code <- renderPrint({\n        glue(\n                'scatter_base +\n                    scale_color_brewer(\n                        palette   = \"{input$option}\",\n                        direction = {if (input$direction) -1 else 1}\n                    )'\n            \n            \n            )\n    })\n\n    ## Plot\n    output$plot <- renderPlot({\n      \n      gapminder |> \n        filter(year == 2007) |> \n        ggplot(\n            aes(x = gdpPercap, y = lifeExp, color = continent)\n        ) +\n        geom_point() +\n        labs(\n            x = \"PIB per cápita\",\n            y = \"Esperanza de vida\"\n        ) +\n        theme_minimal(base_size = 8) +\n        scale_color_brewer(\n            palette   = input$option,\n            direction = if (input$direction) -1 else 1\n        )\n        \n        }, res = 96\n    )\n}\n\n## Run app\nshinyApp(ui = ui, server = server)\n```\n\n## Viridis\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n\n## Load packages\nlibrary(bslib)\nlibrary(dplyr)\nlibrary(gapminder)\nlibrary(ggplot2)\nlibrary(glue)\nlibrary(shiny)\nlibrary(shinyWidgets)\n\n## UI\nui <- page_sidebar(\n    sidebar = sidebar(\n        open = \"open\",\n        width = 200,\n        selectInput(\n            inputId = \"option\", \n            label   = \"Paleta\", \n            choices = c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\"),\n            selected = \"D\"\n        ),\n        prettySwitch(\n            inputId  = \"direction\",\n            label    = \"Invertir paleta\",\n            status   = \"success\",\n            fill     = TRUE\n        )\n    ),\n    verbatimTextOutput(\"code\") |> card(),\n    plotOutput(\"plot\", width = 500) |> card()\n)\n\n## Server\nserver <- function(input, output, session) {\n    \n    output$code <- renderPrint({\n        glue(\n        \n        'scatter_base +\n            scale_color_viridis_d(\n            option    = \"{input$option}\",\n            direction = {if (input$direction) -1 else 1}\n        )'\n            \n            \n            )\n    })\n\n    ## Plot\n    output$plot <- renderPlot({\n      \n      gapminder |>\n        filter(year == 2007) |> \n        ggplot(\n            aes(x = gdpPercap, y = lifeExp, color = continent)\n        ) +\n        geom_point() +\n        labs(\n            x = \"PIB per cápita\",\n            y = \"Esperanza de vida\"\n        ) +\n        theme_minimal(base_size = 8) +\n        scale_color_viridis_d(\n            option    = input$option,\n            direction = if (input$direction) -1 else 1\n        )\n        \n        }, res = 96\n    )\n}\n\n## Run app\nshinyApp(ui = ui, server = server)\n```\n:::\n\nY estas serían las escalas de colores más comunes.\n\n#### Leyendas\n\nPara las variables discretas, la leyenda se controla mediante `guide_legend()`. Además de los argumentos que veíamos con `guide_colorbar()`, tenemos la opción de `nrow` para definir el número de filas de la leyenda o en su caso `ncol` para definir el número de columnas. Vamos a ver un ejemplo:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_base +\n    guides(\n        color = guide_legend(\n            title          = \"Continente\",\n            title.position = \"top\",\n            title.hjust    = .5,\n            position       = \"top\",\n            nrow           = 2\n        )\n    )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\n\n\n\n## Otras escalas\n\nFinalmente, existen escalas para otro tipo de estéticas. Estas funcionan de manera similar a las escalas de colores, ya que también generan una leyenda. En este libro, vamos a ver las escalas de tamaño y de forma.\n\n### Ejercicio 12\n\nEn este ejercicio vamos a trabajar con los datos de inventario. Vamos a empezar cargando los datos, convertirlos a `tibble` y vamos a ver de nuevo su estructura:\n\n```{webr-r}\n## Url de los datos\nurl <- \"https://cidree.github.io/MG_datasets/inventario_prep.csv\"\ninventario_tbl <- read.csv(url) |>\n  as_tibble() |> \n  select(-X)\n## Estructura datos\ninventario_tbl \n```\n\nEl siguiente ejercicio tiene cierta complejidad para preparar los datos. Fíjate que:\n\n-   Las únicas parcelas que se visualizan, son las parcelas mixtas, no las monoespecíficas.\n\n-   Se han ordenado los *boxplot* en orden descendente según el valor del DBH.\n\n-   La parcela debe ser una variable categórica, no numérica\n\n-   La paleta de colores utilizada es *Set3* de ColorBrewer.\n\n-   Para que las líneas de los intervalos mayores sean más llamativas que los intervalos menores, añadir:\n\n``` r\ntheme(\n    panel.grid.major = element_line(color = \"grey85\")\n  )\n```\n\nSi en algún momento te atascas con el preprocesado, puedes ver esa parte en la pestaña de *Pista*.\n\n::: panel-tabset\n## Gráfico esperado\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Resultado esperado del ejercicio 12](1202_scales_files/figure-html/fig-ejercicio-12-1.png){#fig-ejercicio-12 width=672}\n:::\n:::\n\n\n\n\n## Ejercicio\n\n```{webr-r}\ninventario_tbl\n```\n\n## Pista\n\nPrimero se filtran las filas cuyas parcelas (`id_plots`) tengan presentes las dos especies dentro de la columna `nombre_ifn`.\n\nEn siguiente lugar, se convierte `id_plots` a variable categórica y se ordena según la variable `dbh_mm`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninventario_tbl |>\n  filter(\n    all(c(\"Pinus sylvestris\", \"Pinus nigra\") %in% nombre_ifn),\n    .by = id_plots\n  ) |> \n  mutate(\n    id_plots = as.factor(id_plots) |> \n      fct_reorder(dbh_mm)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 336 × 4\n   id_plots dbh_mm height_m nombre_ifn      \n   <fct>     <int>    <dbl> <fct>           \n 1 0           251    NA    Pinus sylvestris\n 2 0           296     9.26 Pinus sylvestris\n 3 0           303    10.1  Pinus sylvestris\n 4 0           105     5.48 Pinus sylvestris\n 5 0           138     7.07 Pinus nigra     \n 6 0           153     7.54 Pinus sylvestris\n 7 0           233     9.60 Pinus sylvestris\n 8 0           140     7.01 Pinus sylvestris\n 9 0           200     7.36 Pinus sylvestris\n10 0           210    10.1  Pinus sylvestris\n# ℹ 326 more rows\n```\n\n\n:::\n:::\n\n\n\n\n## Solución\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninventario_tbl |>\n  filter(\n    all(c(\"Pinus sylvestris\", \"Pinus nigra\") %in% nombre_ifn),\n    .by = id_plots\n  ) |> \n  mutate(\n    id_plots = as.factor(id_plots) |> \n      fct_reorder(dbh_mm)\n  ) |>\n  ggplot(\n    aes(x = dbh_mm / 10, y = id_plots, fill = nombre_ifn)\n  ) +\n  geom_boxplot() +\n  scale_fill_brewer(\n    name    = NULL,\n    palette = \"Set3\",\n  ) +\n  scale_x_continuous(\n    position     = \"top\",\n    breaks       = seq(0, 40, 10),\n    minor_breaks = seq(0, 40, 2.5)\n  ) +\n  labs(\n    x = \"DBH (cm)\",\n    y = \"Parcela\"\n  ) +\n  theme_minimal() +\n  theme(\n    panel.grid.major = element_line(color = \"grey85\")\n  )\n```\n\n::: {.cell-output-display}\n![Resultado del ejercicio 12](1202_scales_files/figure-html/fig-ejercicio-solucion-12-1.png){#fig-ejercicio-solucion-12 width=672}\n:::\n:::\n\n\n\n:::\n\n### Escalas de tamaño\n\nLas escalas de tamaño (`scale_size_*`) se utilizan para modificar el tamaño de elementos de la gráfica, como el tamaño de los puntos o de texto. Esta se puede aplicar tanto a variables continuas como a variables discretas, y las funciones que tenemos disponibles son:\n\n-   `scale_size_continuous()`: para variables continuas.\n\n-   `scale_size_discrete()`: para variables discretas.\n\n-   `scale_size()` y `scale_radius()`: neutrales para modificar el área o el radio. Son las que utilizaremos generalmente.\n\n-   Otras: tenemos otras que sirven para fechas, intervalos, manual para variables discretas, etc.\n\nVamos a empezar trabajando sobre este gráfico:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbubble_base <- gapminder |> \n  filter(year == 2007) |> \n  ggplot(\n      aes(x = gdpPercap, y = lifeExp, fill = continent, size = pop)\n  ) +\n  geom_point(\n    shape = 21\n  ) +\n  labs(\n      x = \"PIB per cápita\",\n      y = \"Esperanza de vida\"\n  ) +\n  theme_minimal()\n\nbubble_base\n```\n\n::: {.cell-output-display}\n![Scatter plot del PIB per cápita, esperanza de vida y población de los países del mundo](1202_scales_files/figure-html/fig-gapminder-scales-size-1.png){#fig-gapminder-scales-size width=672}\n:::\n:::\n\n\n\n\nEl argumento más importante de estas funciones es `range`, que nos permite modificar el rango de tamaños que se van a mostrar en la leyenda. En el siguiente caso, el punto más pequeño tiene tamaño de 1, mientras que el más grande tiene tamaño de 20:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbubble_base +\n  scale_size(\n    name  = \"Población\",\n    range = c(1, 20)\n  )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n\n\n\nTambién podemos modificar utilizando una medida del radio en lugar del área:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbubble_base +\n  scale_radius(\n    name  = \"Población\",\n    range = c(1, 20)\n  )\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n\n\n\nComo véis, el objetivo de las funciones es el mismo pero midiendo el tamaño de distinta manera.\n\n### Escalas de forma\n\nLas escalas de forma (`scale_shape_*`) se utilizan para modificar la forma de los elementos de la gráfica, como la forma de los puntos. Esta se puede aplicar tanto a variables continuas como a variables discretas, y las funciones que tenemos disponibles son:\n\n-   `scale_shape_continuous()`: para variables continuas.\n\n-   `scale_shape_manual()`: para variables discretas.\n\n-   `scale_shape()`: neutral. Es la que utilizaremos generalmente.\n\nEn el siguiente ejemplo se muestran los continentes con las formas que vienen por defecto. Son solid indicamos si las formas son sólidas, o si tienen un borde y relleno:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot <- gapminder |> \n  filter(year == 2007) |> \n  ggplot(\n      aes(x = gdpPercap, y = lifeExp, shape = continent)\n  ) +\n  geom_point(size = 2) +\n  labs(\n      x = \"PIB per cápita\",\n      y = \"Esperanza de vida\"\n  ) +\n  theme_minimal()\n\nsolid_gg <- base_plot +\n  scale_shape(\n    name   = \"Continente\",\n    labels = c(\"África\", \"América\", \"Asia\", \"Europa\", \"Oceanía\")\n  )\n\nno_solid_gg <- base_plot +\n  scale_shape(\n    name   = \"Continente\",\n    labels = c(\"África\", \"América\", \"Asia\", \"Europa\", \"Oceanía\"),\n    solid  = FALSE\n  )\n\nsolid_gg + no_solid_gg\n```\n\n::: {.cell-output-display}\n![](1202_scales_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n\n\n\n## Resumen\n\nEn este capítulo hemos visto diversos tipos de escalas y sus funciones. Hemos visto cómo modificar los intervalos, el número de intervalos, las etiquetas, los límites, las transformaciones, las fechas, las paletas de colores, las paletas manuales, las leyendas, y las escalas de tamaño y forma. En la @tbl-scales-summary se muestra un resumen de las escalas vistas en este capítulo, además de otras que pueden ser utilizadas para otras estéticas.\n\n\n\n\n::: {#tbl-scales-summary .cell tbl-cap='Resumen de las escalas vistas en este capítulo'}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"sncjrvketn\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#sncjrvketn table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#sncjrvketn thead, #sncjrvketn tbody, #sncjrvketn tfoot, #sncjrvketn tr, #sncjrvketn td, #sncjrvketn th {\n  border-style: none;\n}\n\n#sncjrvketn p {\n  margin: 0;\n  padding: 0;\n}\n\n#sncjrvketn .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #929292;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #929292;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#sncjrvketn .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#sncjrvketn .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#sncjrvketn .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#sncjrvketn .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#sncjrvketn .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #929292;\n}\n\n#sncjrvketn .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #929292;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #929292;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#sncjrvketn .gt_col_heading {\n  color: #FFFFFF;\n  background-color: #016763;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#sncjrvketn .gt_column_spanner_outer {\n  color: #FFFFFF;\n  background-color: #016763;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#sncjrvketn .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#sncjrvketn .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#sncjrvketn .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #929292;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#sncjrvketn .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#sncjrvketn .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #929292;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #929292;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#sncjrvketn .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #929292;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #929292;\n  vertical-align: middle;\n}\n\n#sncjrvketn .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#sncjrvketn .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#sncjrvketn .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: dashed;\n  border-top-width: 1px;\n  border-top-color: #929292;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #929292;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #929292;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#sncjrvketn .gt_stub {\n  color: #333333;\n  background-color: #D5D5D5;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #FFFFFF;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sncjrvketn .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#sncjrvketn .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#sncjrvketn .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#sncjrvketn .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sncjrvketn .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #929292;\n}\n\n#sncjrvketn .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#sncjrvketn .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #929292;\n}\n\n#sncjrvketn .gt_grand_summary_row {\n  color: #333333;\n  background-color: #D5D5D5;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sncjrvketn .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #929292;\n}\n\n#sncjrvketn .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #929292;\n}\n\n#sncjrvketn .gt_striped {\n  background-color: #F4F4F4;\n}\n\n#sncjrvketn .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #929292;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #929292;\n}\n\n#sncjrvketn .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#sncjrvketn .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sncjrvketn .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#sncjrvketn .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sncjrvketn .gt_left {\n  text-align: left;\n}\n\n#sncjrvketn .gt_center {\n  text-align: center;\n}\n\n#sncjrvketn .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#sncjrvketn .gt_font_normal {\n  font-weight: normal;\n}\n\n#sncjrvketn .gt_font_bold {\n  font-weight: bold;\n}\n\n#sncjrvketn .gt_font_italic {\n  font-style: italic;\n}\n\n#sncjrvketn .gt_super {\n  font-size: 65%;\n}\n\n#sncjrvketn .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#sncjrvketn .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#sncjrvketn .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#sncjrvketn .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#sncjrvketn .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#sncjrvketn .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#sncjrvketn .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Escala\">Escala</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Estética\">Estética</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Tipo de escala\">Tipo de escala</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Variable\">Variable</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_*_continuous()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">x, y</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Posición</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_*_discrete()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">x, y</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Posición</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Categórica</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_*_log10()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">x, y</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Posición</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_*_sqrt()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">x, y</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Posición</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_*_date()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">x, y</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Posición</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Fecha</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_*_continuous()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_*_discrete()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Discreta</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_*_viridis_c()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_*_viridis_d()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Categórica</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_*_viridis_b()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_*_distiller()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_*_brewer()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Categórica</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_*_fermenter()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_*_gradient()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_*_gradient2()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_*_gradientn()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Continua</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_*_manual()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">color, fill</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Color</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Categórica</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_size()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">size</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Otras</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Ambas</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_area()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">size</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Otras</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Ambas</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_shape()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">shape</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Otras</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Ambas</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left\">scale_linetype()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left\">linetype</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left\">Otras</td>\n<td headers=\"Variable\" class=\"gt_row gt_left\">Ambas</td></tr>\n    <tr><td headers=\"Escala\" class=\"gt_row gt_left gt_striped\">scale_linewidth()</td>\n<td headers=\"Estética\" class=\"gt_row gt_left gt_striped\">linewidth</td>\n<td headers=\"Tipo de escala\" class=\"gt_row gt_left gt_striped\">Otras</td>\n<td headers=\"Variable\" class=\"gt_row gt_left gt_striped\">Ambas</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n## Referencias {.unnumbered}\n\n::: {#refs}\n:::\n\n",
    "supporting": [
      "1202_scales_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}