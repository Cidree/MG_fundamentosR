{
  "hash": "3496a56e8c505ad51939d3e7c26f0a92",
  "result": {
    "engine": "knitr",
    "markdown": "---\nexecute: \n  warning: false\neditor_options: \n  chunk_output_type: console\nfilters: \n    - webr\nwebr:\n    packages: [\"dplyr\", \"ggplot2\"]\n---\n\n\n\n\n# Gr치ficos de relaci칩n\n\nLos gr치ficos de relaci칩n son aquellos que nos permiten visualizar la relaci칩n que tienen entre s칤 dos o m치s variables. Dentro de los gr치ficos de relaci칩n tambi칠n se puede denominar gr치ficos de correlaci칩n, y agrupan una familia m치s grande que la que ve칤amos en la @fig-vis-classification.\n\nEn este cap칤tulo veremos los siguientes gr치ficos de relaci칩n:\n\n1.  Gr치fico de dispersi칩n (*Scatter plot*)\n\n2.  Gr치fico de burbujas (*Bubble plot*)\n\n3.  Mapa de calor (*Heatmap*)\n\nEn este cap칤tulo vamos a trabajar con dos datasets:\n\n-   `iris`: se utilizar치 para los ejemplos utilizados en las explicaciones (ver [Tipos de visualizaci칩n](#sec-visualization-types){target=\"_blank\"}). <!--# eliminar? -->\n\n-   `gapminder`: se utilizar치 para los ejemplos utilizados en las explicaciones (ver [Tipos de visualizaci칩n](#sec-visualization-types){target=\"_blank\"}). Filtraremos solamente los datos del 2002.\n\n-   `inventario`: ser치n los datos que utilizar치n los alumnos para los ejercicios propuestos (ver @sec-vis-data).\n\nPara comenzar, vamos a cargar los paquetes necesarios y a leer los datos que utilizaremos en este cap칤tulo.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargar paquetes\nlibrary(dplyr)\nlibrary(gapminder)\nlibrary(ggplot2)\nlibrary(readr)\n# Cargar datos\ninventario_tbl <- read_rds(\"data/inventario_prep.rds\")\ngapminder_tbl <- gapminder |> \n    filter(year == 2002)\n```\n:::\n\n\n\n\n## Objetivos\n\nAl final de este cap칤tulo ser치s capaz de:\n\n-   Utilizar un tema distinto por defecto\n\n-   Crear gr치ficos de dispersi칩n y burbujas\n\n-   Crear mapas de calor\n\n-   Controlar colores utilizando `scales`\n\n-   Mover la leyenda\n\n## Gr치ficos de dispersi칩n\n\nAntes de empezar, vamos a ver como modificar el tema que viene por defecto en `{ggplot2}`, para que no tengamos que a침adirlo en cada gr치fico que hagamos.\n\nUtilizando la funci칩n `theme_set()` podemos establecer un tema por defecto para todos los gr치ficos que hagamos en el documento. En este caso, hemos seleccionado el tema `theme_classic()`, que es uno de los temas m치s utilizados en `{ggplot2}`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_set(\n    theme_classic()\n)\n```\n:::\n\n\n\n\nLos gr치ficos de dispersi칩n son una de las formas m치s comunes de visualizar la relaci칩n entre dos **variables num칠ricas**. En un gr치fico de dispersi칩n, cada punto representa una observaci칩n y se coloca en el eje `x` seg칰n el valor de la primera variable y en el eje `y` seg칰n el valor de la segunda variable.\n\nPara crear un gr치fico de dispersi칩n en `ggplot2` se utiliza la funci칩n `geom_point()`. A continuaci칩n, se muestra un ejemplo de c칩mo crear un gr치fico de dispersi칩n utilizando el *dataset* `gapminder` relacionando el PIB per c치pita con la esperanza de vida, y coloreando los puntos seg칰n el continente.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Crear gr치fico\nbase_scatter_gg <- gapminder_tbl |> \n    ggplot(\n        aes(x = gdpPercap, y = lifeExp, color = continent)\n    ) +\n    geom_point(\n        size = 2\n    ) +\n    labs(\n        x = \"PIB per c치pita\",\n        y = \"Esperanza de vida\"\n    )\n## Imprimir\nbase_scatter_gg\n```\n\n::: {.cell-output-display}\n![Gr치fico de dispersi칩n con ggplot2](1103_relationship_files/figure-html/fig-dispersion-scatter-1.png){#fig-dispersion-scatter width=672}\n:::\n:::\n\n\n\n\nF칤jate que como hemos utilizado `theme_set()` al principio del documento, no hemos tenido que a침adir `theme_classic()` en el gr치fico.\n\nPues as칤 de sencillo es crear un gr치fico de dispersi칩n en `ggplot2`. Como ya estamos familiarizados con la funcionalidad b치sica, vamos a aprender a cambiar los colores de los puntos y a mover la leyenda.\n\nVamos a empezar modificando los colores de cada uno de los continentes para que sean:\n\n-   `츼frica`: naranja\n\n-   `Am칠rica`: negro\n\n-   `Asia`: lila\n\n-   `Europa`: azul\n\n-   `Ocean칤a`: verde\n\nSi record치is, en la @sec-components-scales ve칤amos que las variables num칠ricas traen por defecto una escala continua (i.e. `scale_*_continuous()`) y las variables categ칩ricas una escala de discreta (i.e. `scale_*_discrete()`).\n\nEn este caso, queremos cambiar los colores de las especies, y para ello tenemos que modificar la escala a `manual` con la funci칩n `scale_color_manual()`. A continuaci칩n, se muestra el c칩digo para cambiar los colores de las especies:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Crear gr치fico\nscales_scatter_gg <- base_scatter_gg +\n    scale_color_manual(\n        name   = \"Continente\",\n        values = c(\"#FF5733\", \"black\", \"#A833FF\", \"#3366FF\", \"#33FF57\")\n    )\n## Imprimir\nscales_scatter_gg\n```\n\n::: {.cell-output-display}\n![Gr치fico de dispersi칩n con ggplot2](1103_relationship_files/figure-html/fig-dispersion-scatter-colors-1.png){#fig-dispersion-scatter-colors width=672}\n:::\n:::\n\n\n\n\nCon el argumento `name` de las funciones `scale*` podemos cambiar el nombre de la leyenda, y en `values` tenemos que especificar un vector con los colores que queremos asignar a cada categor칤a.\n\n::: callout-note\nEn @fig-dispersion-scatter-colors hemos asignado a `values` un vector de longitud 5 porque tenemos 5 categor칤as (1 por continente). Si asignamos m치s colores de los necesarios, la funci칩n los ignorar치, mientras que si asignamos menos, la funci칩n nos dar치 el error: *`Insufficient values in manual scale`*\n:::\n\nLo siguiente que vamos a aprender es a mover la leyenda. Aqu칤 tenemos dos opciones:\n\n-   Utilizar una posici칩n relativa al gr치fico\n\n-   Utilizar una posici칩n absoluta dentro del gr치fico\n\nVamos a utilizar el m칠todo introducido en la versi칩n 3.5.0 de `{ggplot2}` que es el siguiente:\n\n::: panel-tabset\n## Posici칩n relativa\n\nLa posici칩n relativa es la m치s sencilla. La forma **recomendable** es la siguiente, ya que si tuvi칠ramos m치s de una leyenda, podr칤amos controlar la posici칩n de cada una dentro de `guides`.\n\nLo que estamos haciendo es: (1) utilizar la funci칩n `guides`; (2) como argumento utilizar el nombre la est칠tica de la leyenda que queremos modificar (`color`); (3) utilizar la funci칩n `guide_legend()` que tiene muchos argumentos para modificar la leyenda.\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n\n## Load packages\nlibrary(bslib)\nlibrary(dplyr)\nlibrary(gapminder)\nlibrary(ggplot2)\nlibrary(glue)\nlibrary(shiny)\n\n## UI\nui <- page_sidebar(\n    sidebar = sidebar(\n        open = \"open\",\n        width = 200,\n        selectInput(\n            inputId = \"position_input\", \n            label   = \"Posici칩n\", \n            choices = c(\"bottom\", \"top\", \"left\", \"right\", \"inside\"),\n        )\n    ),\n    verbatimTextOutput(\"code\") |> card(),\n    plotOutput(\"plot\", width = 500) |> card()\n)\n\n## Server\nserver <- function(input, output, session) {\n    \n    output$code <- renderPrint({\n        glue(\n            '\n            scales_scatter_gg +\n                guides(\n                    color = guide_legend(\n                        position = \"{input$position_input}\"\n                    )\n                )'\n            )\n    })\n\n    ## Plot\n    output$plot <- renderPlot({\n        gapminder |> \n            filter(year == 2002) |> \n            ggplot(\n                aes(x = gdpPercap, y = lifeExp, color = continent)\n            ) +\n            geom_point(\n                size = 2\n            ) +\n            labs(\n                x = \"PIB per c치pita\",\n                y = \"Esperanza de vida\"\n            ) +\n            scale_color_manual(\n                name   = \"Continente\",\n                values = c(\"#FF5733\", \"black\", \"#A833FF\", \"#3366FF\", \"#33FF57\")\n            ) +\n            guides(\n                color = guide_legend(\n                    position = {input$position_input}\n                )\n            ) +\n            theme_bw(base_size = 8)\n        }, res = 96\n    )\n}\n\n## Run app\nshinyApp(ui = ui, server = server)\n```\n\n## Posici칩n absoluta\n\nPara la posici칩n absoluta, debemos utilizar `position = \"inside\"`. Una vez hecho esto, debemos modificar el argumento `legend.position.inside` dentro de la funci칩n `theme()` indicar un vector num칠rico de longitud 2, donde el primer n칰mero indica el % de desplazamiento sobre el eje `x` desde el origen, mientras que el segundo n칰mero indica el % de desplazamiento sobre el eje `y`. Prueba a cambiar los valores en la siguiente aplicaci칩n para entender su funcionamiento:\n\n```{shinylive-r}\n#| standalone: true\n#| viewerHeight: 600\n\n## Load packages\nlibrary(bslib)\nlibrary(dplyr)\nlibrary(gapminder)\nlibrary(ggplot2)\nlibrary(glue)\nlibrary(shiny)\n\n## UI\nui <- page_sidebar(\n    sidebar = sidebar(\n        open = \"open\",\n        width = 200,\n        sliderInput(\n            inputId = \"position_input_x\", \n            label   = \"Posici칩n eje x\",\n            min     = 0,\n            max     = 1,\n            value   = 0.5,\n            step    = 0.1\n        ),\n        sliderInput(\n            inputId = \"position_input_y\", \n            label   = \"Posici칩n eje y\",\n            min     = 0,\n            max     = 1,\n            value   = 0.5,\n            step    = 0.1\n        )\n    ),\n    verbatimTextOutput(\"code\") |> card(),\n    plotOutput(\"plot\", width = 500) |> card()\n)\n\n## Server\nserver <- function(input, output, session) {\n    \n    output$code <- renderPrint({\n        glue(\n            '\n            scales_scatter_gg +\n                guides(\n                    color = guide_legend(\n                        position = \"inside\"\n                    )\n                ) +\n                theme(\n                    legend.position.inside = c({input$position_input_x}, {input$position_input_y})'\n            )\n    })\n\n    ## Plot\n    output$plot <- renderPlot({\n        gapminder |> \n            filter(year == 2002) |> \n            ggplot(\n                aes(x = gdpPercap, y = lifeExp, color = continent)\n            ) +\n            geom_point(\n                size = 2\n            ) +\n            labs(\n                x = \"PIB per c치pita\",\n                y = \"Esperanza de vida\"\n            ) +\n            scale_color_manual(\n                name   = \"Continente\",\n                values = c(\"#FF5733\", \"black\", \"#A833FF\", \"#3366FF\", \"#33FF57\")\n            ) +\n            guides(\n                color = guide_legend(\n                    position = {input$position_input}\n                )\n            ) +\n            theme_bw(base_size = 8) +\n            theme(\n                legend.position.inside = c(input$position_input_x, input$position_input_y))\n            }, res = 96\n    )\n}\n\n## Run app\nshinyApp(ui = ui, server = server)\n```\n:::\n\n## Gr치ficos de burbujas\n\nLos gr치ficos de burbujas son una extensi칩n de los gr치ficos de dispersi칩n, donde se a침ade una **tercera variable num칠rica** que se representa mediante el tama침o de los puntos.\n\n::: callout-note\nEn la pr치ctica, si utilizamos las est칠ticas de `color` y `size`, estamos visualizando 4 variables num칠ricas al mismo tiempo!!\n:::\n\nEn `ggplot2`, podemos a침adir una tercera variable utilizando la est칠tica `size` en la funci칩n `aes()`. Al *scatter plot* anterior, vamos a a침adirle como variable de `size` la poblaci칩n. Como vamos a a침adir nuevos elementos, vamos a a침adir el c칩digo paso a paso:\n\n::: panel-tabset\n## 1. Bubble plot\n\nEmpezamos generando un *bubble plot* a침adiendo la variable *pop:*\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Crear gr치fico\nbubble_base <- gapminder_tbl |> \n    ggplot(\n        aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)\n    ) +\n    geom_point(\n        alpha = 0.7\n    ) +\n    labs(\n        x = \"PIB per c치pita\",\n        y = \"Esperanza de vida\"\n    ) +\n    scale_color_manual(\n        name   = \"Continente\",\n        values = c(\"#FF5733\", \"black\", \"#A833FF\", \"#3366FF\", \"#33FF57\")\n    )\n## Imprimir\nbubble_base\n```\n\n::: {.cell-output-display}\n![](1103_relationship_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n## 2. Tama침o puntos\n\nEl tama침o de los puntos al igual que el color de los mismos es una est칠tica. Para modificar una est칠tica mapeada a una variable utilizamos las funciones `scale_*`. Como la est칠tica es `size`, utilizamos `scale_size*()`. En el argumento `range` indicamos el tama침o del punto m치s peque침o y el tama침o del punto m치s grande:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Crear gr치fico\nbubble_size <- bubble_base +\n    scale_size(range = c(1, 15))\n## Imprimir\nbubble_size\n```\n\n::: {.cell-output-display}\n![](1103_relationship_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n## 3. Eliminar una leyenda\n\nRecuerdas la funci칩n `guides` que vimos antes? Si igualamos una de las est칠ticas a `\"none\"` eliminaremos solamente esa leyenda:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Crear gr치fico\nbubble_guides <- bubble_size +\n    guides(\n        size = \"none\"\n    )\n## Imprimir\nbubble_guides\n```\n\n::: {.cell-output-display}\n![](1103_relationship_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n## 4. Posicionar leyenda\n\nPara terminar, vamos a posicionar la leyenda del continente en la parte inferior derecha del gr치fico para aprovechar el espacio:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Crear gr치fico\nbubble_final <- bubble_guides +\n    guides(\n        color = guide_legend(\n            position = \"inside\"\n        )\n    ) +\n    theme(\n        legend.position.inside = c(.9, .2)\n    ) \n## Imprimir\nbubble_final\n```\n\n::: {.cell-output-display}\n![](1103_relationship_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n## 5. Resumen\n\nPara terminar, vamos a ver como se ver칤a todo el c칩digo en un solo bloque:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder_tbl |> \n    ## Capas\n    ggplot(\n        aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)\n    ) +\n    geom_point(\n        alpha = 0.7\n    ) +\n    ## Etiquetas\n    labs(\n        x = \"PIB per c치pita\",\n        y = \"Esperanza de vida\"\n    ) +\n    ## Escalas y gu칤as\n    scale_color_manual(\n        name   = \"Continente\",\n        values = c(\"#FF5733\", \"black\", \"#A833FF\", \"#3366FF\", \"#33FF57\")\n    ) +\n    scale_size(range = c(1, 15)) +\n    guides(\n        size  = \"none\",\n        color = guide_legend(\n            position = \"inside\"\n        )\n    ) +\n    ## Temas\n    theme(\n        legend.position.inside = c(.9, .2)\n    ) \n```\n\n::: {.cell-output-display}\n![](1103_relationship_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n:::\n\nUff 游땬... Si es tu primera vez estudiando `{ggplot2}` es posible que te est칠 explotando la cabeza. No te preocupes!! Es normal que al principio te cueste, pero poco a poco iremos domin치ndolo juntos游땙.\n\n### Ejercicio 7\n\nEs hora de ponerse manos a la obra! El objetivo del siguiente ejercicio es replicar el siguiente gr치fico con el *dataset* de `iris`:\n\n::: panel-tabset\n## Gr치fico\n\nIntenta replicar este gr치fico en la pesta침a \"Ejercicio\"\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Resultado del ejercicio 7](1103_relationship_files/figure-html/fig-distribution-ej7-1.png){#fig-distribution-ej7 width=672}\n:::\n:::\n\n\n\n\n## Ejercicio\n\nCompletar el c칩digo:\n\n```{webr-r}\niris |> \n    ## Introducir c칩digo\n    labs(\n        title = \"Relaci칩n entre longitud de p칠talo, anchura de p칠talo y longitud de s칠palo\",\n        x = \"Longitud de p칠talo (mm)\",\n        y = \"Anchura de p칠talo (mm)\"\n    ) \n```\n\n## Soluci칩n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Soluci칩n del ejercicio 7](1103_relationship_files/figure-html/fig-distribution-ej7-sol-1.png){#fig-distribution-ej7-sol width=672}\n:::\n:::\n\n\n\n:::\n\n## Mapas de calor\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\"hello\"\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"hello\"\n```\n\n\n:::\n:::\n",
    "supporting": [
      "1103_relationship_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}